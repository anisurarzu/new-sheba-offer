{"ast":null,"code":"import _regeneratorRuntime from\"/Users/macbookair/Desktop/Anis/Sheba Offer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/macbookair/Desktop/Anis/Sheba Offer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/macbookair/Desktop/Anis/Sheba Offer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{CardElement,useElements,useStripe}from\"@stripe/react-stripe-js\";import{Spin}from\"antd\";import React,{useEffect,useState}from\"react\";import useAuth from\"../../hooks/useAuth\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CheckoutForm=function CheckoutForm(_ref){var price=_ref.price;var stripe=useStripe();var elements=useElements();var _useAuth=useAuth(),user=_useAuth.user;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),success=_useState4[0],setSuccess=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),process=_useState6[0],setProcess=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),clientSecret=_useState8[0],setClientSecret=_useState8[1];console.log(price);useEffect(function(){fetch(\"https://yellow-sparkly-station.glitch.me/create-payment-intent\",{method:\"POST\",headers:{\"content-type\":\"application/json\"},body:JSON.stringify({price:price})}).then(function(res){return res.json();}).then(function(data){return setClientSecret(data.clientSecret);}).catch(function(error){console.log(error);});},[price]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var card,_yield$stripe$createP,error,paymentMethod,_yield$stripe$confirm,paymentIntent,intentError,payment;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:// Get a reference to a mounted CardElement. Elements knows how\n// to find your CardElement because there can only ever be one of\n// each type of element.\ncard=elements.getElement(CardElement);if(!(card===null)){_context.next=6;break;}return _context.abrupt(\"return\");case 6:// Use your card Element with other Stripe.js APIs\nsetProcess(true);_context.next=9;return stripe.createPaymentMethod({type:\"card\",card:card});case 9:_yield$stripe$createP=_context.sent;error=_yield$stripe$createP.error;paymentMethod=_yield$stripe$createP.paymentMethod;if(error){setError(error.message);setSuccess(\"\");}else{setError(\"\");console.log(paymentMethod);}// payment intent\n_context.next=15;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:card,billing_details:{name:user===null||user===void 0?void 0:user.displayName,email:user===null||user===void 0?void 0:user.email}}});case 15:_yield$stripe$confirm=_context.sent;paymentIntent=_yield$stripe$confirm.paymentIntent;intentError=_yield$stripe$confirm.error;if(intentError){setError(intentError.message);setSuccess(\"\");}else{setError(\"\");setSuccess(\"Your payment processed successfully!\");console.log(paymentIntent);setProcess(false);// save to database\npayment={name:user===null||user===void 0?void 0:user.displayName,email:user===null||user===void 0?void 0:user.email,amount:paymentIntent.amount,created:paymentIntent.created,transaction:paymentIntent.client_secret.slice(\"_secret\")[0],lastFourDigit:paymentMethod.card.last4};fetch(\"https://yellow-sparkly-station.glitch.me/paymentInfo\",{method:\"POST\",headers:{\"content-type\":\"application/json\"},body:JSON.stringify(payment)}).then(function(res){return res.json();}).then(function(data){window.location.replace(\"dashboard/mypaymentInfo\");}).catch(function(error){console.log(error);});}case 19:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"form\",{className:\"mx-96\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{options:{style:{base:{fontSize:\"16px\",color:\"#424770\",\"::placeholder\":{color:\"#aab7c4\"}},invalid:{color:\"#9e2146\"}}}}),process?/*#__PURE__*/_jsx(Spin,{}):/*#__PURE__*/_jsxs(\"button\",{className:\"service-btn\",type:\"submit\",disabled:!stripe,children:[\"Pay $\",price]})]}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:\"red\"},children:error}),success&&/*#__PURE__*/_jsx(\"p\",{style:{color:\"green\"},children:success})]});};export default CheckoutForm;","map":{"version":3,"sources":["/Users/macbookair/Desktop/Anis/Sheba Offer/src/Pages/Payment/CheckoutForm.js"],"names":["CardElement","useElements","useStripe","Spin","React","useEffect","useState","useAuth","CheckoutForm","price","stripe","elements","user","error","setError","success","setSuccess","process","setProcess","clientSecret","setClientSecret","console","log","fetch","method","headers","body","JSON","stringify","then","res","json","data","catch","handleSubmit","e","preventDefault","card","getElement","createPaymentMethod","type","paymentMethod","message","confirmCardPayment","payment_method","billing_details","name","displayName","email","paymentIntent","intentError","payment","amount","created","transaction","client_secret","slice","lastFourDigit","last4","window","location","replace","style","base","fontSize","color","invalid"],"mappings":"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","sourcesContent":["import { CardElement, useElements, useStripe } from \"@stripe/react-stripe-js\";\nimport { Spin } from \"antd\";\nimport React, { useEffect, useState } from \"react\";\nimport useAuth from \"../../hooks/useAuth\";\n\nconst CheckoutForm = ({ price }) => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { user } = useAuth();\n  const [error, setError] = useState(\"\");\n  const [success, setSuccess] = useState(\"\");\n  const [process, setProcess] = useState(false);\n\n  const [clientSecret, setClientSecret] = useState(\"\");\n  console.log(price);\n\n  useEffect(() => {\n    fetch(\"https://yellow-sparkly-station.glitch.me/create-payment-intent\", {\n      method: \"POST\",\n      headers: {\n        \"content-type\": \"application/json\",\n      },\n      body: JSON.stringify({ price }),\n    })\n      .then((res) => res.json())\n      .then((data) => setClientSecret(data.clientSecret))\n      .catch((error) => {\n        console.log(error);\n      });\n  }, [price]);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!stripe || !elements) {\n      // Stripe.js has not loaded yet. Make sure to disable\n      // form submission until Stripe.js has loaded.\n      return;\n    }\n    // Get a reference to a mounted CardElement. Elements knows how\n    // to find your CardElement because there can only ever be one of\n    // each type of element.\n    const card = elements.getElement(CardElement);\n\n    if (card === null) {\n      return;\n    }\n\n    // Use your card Element with other Stripe.js APIs\n    setProcess(true);\n    const { error, paymentMethod } = await stripe.createPaymentMethod({\n      type: \"card\",\n      card,\n    });\n\n    if (error) {\n      setError(error.message);\n      setSuccess(\"\");\n    } else {\n      setError(\"\");\n      console.log(paymentMethod);\n    }\n    // payment intent\n    const { paymentIntent, error: intentError } =\n      await stripe.confirmCardPayment(clientSecret, {\n        payment_method: {\n          card: card,\n          billing_details: {\n            name: user?.displayName,\n            email: user?.email,\n          },\n        },\n      });\n    if (intentError) {\n      setError(intentError.message);\n      setSuccess(\"\");\n    } else {\n      setError(\"\");\n      setSuccess(\"Your payment processed successfully!\");\n      console.log(paymentIntent);\n      setProcess(false);\n      // save to database\n\n      const payment = {\n        name: user?.displayName,\n        email: user?.email,\n        amount: paymentIntent.amount,\n        created: paymentIntent.created,\n        transaction: paymentIntent.client_secret.slice(\"_secret\")[0],\n        lastFourDigit: paymentMethod.card.last4,\n      };\n      fetch(\"https://yellow-sparkly-station.glitch.me/paymentInfo\", {\n        method: \"POST\",\n        headers: {\n          \"content-type\": \"application/json\",\n        },\n        body: JSON.stringify(payment),\n      })\n        .then((res) => res.json())\n        .then((data) => {\n          window.location.replace(\"dashboard/mypaymentInfo\");\n        })\n        .catch((error) => {\n          console.log(error);\n        });\n    }\n  };\n  return (\n    <div>\n      <form className=\"mx-96\" onSubmit={handleSubmit}>\n        <CardElement\n          options={{\n            style: {\n              base: {\n                fontSize: \"16px\",\n                color: \"#424770\",\n                \"::placeholder\": {\n                  color: \"#aab7c4\",\n                },\n              },\n              invalid: {\n                color: \"#9e2146\",\n              },\n            },\n          }}\n        />\n        {process ? (\n          <Spin></Spin>\n        ) : (\n          <button className=\"service-btn\" type=\"submit\" disabled={!stripe}>\n            Pay ${price}\n          </button>\n        )}\n      </form>\n\n      {error && <p style={{ color: \"red\" }}>{error}</p>}\n      {success && <p style={{ color: \"green\" }}>{success}</p>}\n    </div>\n  );\n};\n\nexport default CheckoutForm;\n"]},"metadata":{},"sourceType":"module"}